# My Schedule

個人用タスク管理PWA（Vite + React + TypeScript + IndexedDB）

## ローカル起動

```bash
npm ci
npm run dev
```

ブラウザで http://localhost:5173 を開く。

## PWA インストール

1. `npm run build && npm run preview` でプロダクションビルドを起動
2. ブラウザのアドレスバーに表示されるインストールアイコン、またはメニューの「ホーム画面に追加」/「アプリをインストール」を選択
3. インストール後はオフラインでも起動可能

## データ保存

IndexedDB（DB名: `my-schedule-db`）にローカル永続化。ブラウザを閉じてもデータは保持される。

## バックアップ / 復元

- **Settings** 画面からJSONエクスポート/インポートが可能
- エクスポート: 全データ（タスク・グループ・プロジェクト・Bucket・繰り返しテンプレート）をJSONファイルとしてダウンロード
- インポート: エクスポートしたJSONを選択して全上書き復元（既存データは置き換え）
- 定期的なエクスポートを推奨（ブラウザのストレージクリアでデータ消失のリスクあり）

## 依存ライブラリ

- **react-router-dom** - ページルーティング
- **dexie** - IndexedDBラッパー

## 実装状況

### Cycle-01: タスクCRUD
- タスクCRUD（追加/編集/完了トグル/論理削除）
- 一覧のフィルタ（状態/優先度/期限区分）
- 一覧のソート（期限昇順/優先度降順/更新日降順）

### Cycle-02: マスタ管理
- グループ/プロジェクト/BucketのCRUD
- タスクへの分類紐付け・フィルタ

### Cycle-03: PWA + バックアップ
- PWA化（manifest / Service Worker / オフラインキャッシュ）
- JSONエクスポート/インポート

### Cycle-04: 繰り返しテンプレート & 自動生成
- 繰り返しテンプレートCRUD（Repeat画面）
- 対応パターン: 毎週（曜日指定）/ 毎月（日付指定）/ 毎月（第N曜日指定）
- Tasks画面を開くたびに次回タスクを自動生成
- 新規タスク作成時に繰り返し設定を同時作成可能
- バックアップ（Export/Import）にテンプレートを含む

#### 使い方

1. **Repeat** 画面でテンプレートを作成（種別・曜日/日付・優先度などを設定）
2. **Tasks** 画面を開くと、アクティブなテンプレートから次回分のタスクが自動生成される
3. 生成されたタスクには「繰り返し」バッジが表示される

#### 割り切り・制約

- 生成は「次回1件先読み」のみ（複数先は生成しない）
- テンプレートの有効/無効はRepeat画面で切り替え可能
- 月末存在しない日（例: 2月31日）はスキップして翌月以降を探索
- 第5週が存在しない月もスキップ

#### 二重生成防止

- 同一テンプレートID + 同一期限日のタスクが既に存在する場合は生成をスキップ
- `lastGeneratedDate` による安全弁チェック（同日重複呼び出し対策）
- ページリロードしても増殖しない

### Cycle-05: ダッシュボード
- ホーム画面（/dashboard）を追加（/ はダッシュボードへリダイレクト）
- 期限別（期限切れ/今日/今週/今月）件数カード
- 状態別（未着手/進行中/完了）件数カード
- 優先度別（High/Med/Low）件数カード
- 期限切れ・今日のタスクをクイック一覧表示（todo/in_progressのみ、上限10件）
- カードクリックでTasksにフィルタ付き遷移（URLクエリ連携）

### Cycle-06: Focus / Planning UI分離

3層モードで認知負荷を最小化:

| モード | 画面 | パス | 役割 |
|---|---|---|---|
| 戦略室 | Home | /dashboard | 件数サマリ・全体俯瞰 |
| 実行室 | Focus | /focus | 今やるべきタスクに集中 |
| 設計室 | Planning | /tasks | フィルタ・詳細編集・管理 |

- **Focus（/focus）**: 期限切れ/今日/今週High のみ表示。完了トグルだけ。最小情報（タイトル+期限+優先度アイコン）
- **Planning（/tasks）**: フィルタはデフォルト非表示（「詳細フィルタ」で展開）。タスク行は最小表示、クリックで詳細展開（状態/分類/メモ/編集/削除）
- 優先度はアイコン表示（↑ High / → Med / ↓ Low）

#### 画面導線

| 画面 | パス | 概要 |
|---|---|---|
| Home | /dashboard | 件数サマリ + 今日やること |
| Focus | /focus | 実行モード（完了トグルのみ） |
| Planning | /tasks | タスク一覧・フィルタ・詳細編集 |
| + New | /tasks/new | タスク新規作成 |
| Masters | /masters | グループ/プロジェクト/Bucket管理 |
| Repeat | /recurrence | 繰り返しテンプレート管理 |
| Settings | /settings | Export/Import・PWA情報 |

#### 使い分け

1. **Home** でタスクの全体像を確認
2. **Focus** で今やるべきタスクに集中して消化
3. **Planning** でタスクの追加・編集・整理を行う

### Cycle-07: Dashboard戦略再設計

Dashboard を3段構造に再設計し、色の意味を単一化:

- **上段（戦略サマリー）**: 総タスク数 / 進行中 / 完了率 / 今週達成率
- **中段（危険ゾーン）**: 期限切れ / 今日期限 / 今週High の件数（クリックでFocusへ）+ クイックプレビュー
- **下段（分野別進捗）**: Group別の完了率と進捗バー（クリックでPlanningにフィルタ遷移）+ 未分類も表示

#### 色ルール

| 色 | 意味 | 使用場所 |
|---|---|---|
| 赤 | 期限切れ・今日期限（危険） | 危険ゾーンカード |
| 黄 | 今週High（注意） | 危険ゾーンカード |
| 灰 | 状態（done等の弱表示） | 完了タスク |
| 青 | 分野（Group） | 分野別進捗のみ |

- 優先度には色を使わない（アイコンのみ: ↑/→/↓）
- 同一要素に複数強調色を使わない

### Cycle-08: Focus Mode 仕上げ

Focus を「実行の主戦場」として完成:

- 表示順の安定化: overdue → today → 今週High（各セクション内は dueDate 昇順）
- **着手トグル**: todo ↔ in_progress をワンタップ切替（「着手」「着手中」ボタン）
- 完了トグル: チェックで done → リストから消える
- **クイック追加**: タイトル入力のみで今日のタスクを即追加（due=today, priority=med, status=todo）
- Planning への導線: 「設計室で整理 →」リンク

## 未対応（次サイクル以降）

- 検索
- テスト
